<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sleepscan AI - Understand your sleep. Fix your routine.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* ====== Base styles ====== */
    :root {
      --bg: #050816;
      --bg-card: #0b1020;
      --accent: #3abff8;
      --accent-soft: rgba(58, 191, 248, 0.2);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --border: #1f2933;
      --radius: 14px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
  min-height: 100vh;
  color: var(--text-main);
  line-height: 1.5;

  /* Night sky photo + dark gradient overlay */
  background-color: #020617;
  background-image:
    linear-gradient(to bottom, rgba(3, 7, 18, 0.7), rgba(3, 7, 18, 0.97)),
    url("https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?auto=format&fit=crop&w=1920&q=80");
  background-size: cover;
  background-position: center top;
  background-attachment: fixed;
}

    a {
      color: inherit;
      text-decoration: none;
    }

    button {
      cursor: pointer;
      border: none;
    }

    .container {
      width: 100%;
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* ====== Nav ====== */
    .nav {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(12px);
      background: rgba(3, 7, 18, 0.75);
      border-bottom: 1px solid rgba(31, 41, 55, 0.7);
    }

    .nav-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.9rem 0;
    }

    .logo {
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.06em;
    }

    .logo span {
      color: var(--accent);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .nav-cta {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--text-main);
      font-size: 0.85rem;
      border: 1px solid rgba(58, 191, 248, 0.6);
    }

    /* ====== Sections ====== */
    section {
  position: relative;
  padding: 3rem 0;
  z-index: 0; /* create stacking context for overlay */
}

/* Dark, subtle overlay so content is readable on top of the sky */
section::before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: -1;
  background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(2, 6, 23, 0.98));
  opacity: 0.95;
}

@media (min-width: 768px) {
  section {
    padding: 4.5rem 0;
  }
}

/* Hero a bit lighter so more of the sky shows through */
.hero::before {
  background: radial-gradient(circle at top, rgba(15, 23, 42, 0.75), rgba(2, 6, 23, 0.95));
}

    .section-header {
      margin-bottom: 1.5rem;
    }

    .section-title {
      font-size: 1.4rem;
      font-weight: 600;
    }

    .section-subtitle {
      font-size: 0.95rem;
      color: var(--text-muted);
      margin-top: 0.35rem;
    }

    /* ====== Hero ====== */
    .hero {
      padding-top: 3rem;
      padding-bottom: 3.5rem;
    }

    @media (min-width: 900px) {
      .hero-inner {
        display: grid;
        grid-template-columns: minmax(0, 3fr) minmax(0, 2.3fr);
        gap: 2.5rem;
        align-items: center;
      }
    }

    .hero-eyebrow {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent);
      margin-bottom: 0.75rem;
    }

    .hero-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.8rem;
    }

    @media (min-width: 768px) {
      .hero-title {
        font-size: 2.45rem;
      }
    }

    .hero-subtext {
      font-size: 0.95rem;
      color: var(--text-muted);
      max-width: 30rem;
      margin-bottom: 1.1rem;
    }

    .hero-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .chip {
      font-size: 0.75rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.8);
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    .btn-primary {
      padding: 0.7rem 1.3rem;
      border-radius: 999px;
      background: linear-gradient(135deg, #22d3ee, #3b82f6);
      color: #0b1120;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 12px 25px rgba(37, 99, 235, 0.35);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .hero-card {
      margin-top: 1.5rem;
      background: radial-gradient(circle at top, #1e293b, #020617);
      border-radius: 1.3rem;
      padding: 1.25rem 1.4rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      max-width: 22rem;
    }

    .hero-card-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 0.5rem;
    }

    .hero-card-score {
      font-size: 2.3rem;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .hero-card-score span {
      font-size: 1rem;
      color: var(--text-muted);
      margin-left: 0.3rem;
      font-weight: 500;
    }

    .hero-card-text {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .hero-card-pill {
      margin-top: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.75rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(58, 191, 248, 0.7);
      color: var(--accent);
    }

    .hero-card-pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--danger);
    }

    /* ====== How it works ====== */
    .how-grid {
      display: grid;
      gap: 1rem;
      margin-top: 1.25rem;
    }

    @media (min-width: 768px) {
      .how-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .how-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
    }

    .how-step {
      font-size: 0.75rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 0.4rem;
    }

    .how-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .how-body {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    /* ====== Form ====== */
    .card {
      background: var(--bg-card);
      border-radius: 1.25rem;
      padding: 1.5rem;
      border: 1px solid var(--border);
    }

    @media (min-width: 768px) {
      .card {
        padding: 1.8rem;
      }
    }

    .form-grid {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 768px) {
      .form-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      font-size: 0.85rem;
    }

    .field label {
      font-weight: 500;
    }

    .field span {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .input,
    .select,
    .textarea,
    .range {
      background: #020617;
      border: 1px solid rgba(31, 41, 55, 0.9);
      border-radius: 0.7rem;
      padding: 0.55rem 0.7rem;
      color: var(--text-main);
      font-size: 0.85rem;
    }

    .textarea {
      resize: vertical;
      min-height: 70px;
    }

    .range {
      padding: 0.35rem;
    }

    .form-footer {
      margin-top: 1.3rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .btn-submit {
      align-self: flex-start;
      margin-top: 0.2rem;
    }

    /* ====== Loading ====== */
    .loading {
      display: none;
      margin-top: 1.25rem;
      border-radius: var(--radius);
      padding: 1rem 1.2rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(37, 99, 235, 0.4);
      font-size: 0.85rem;
    }

    .loading-title {
      font-weight: 500;
      margin-bottom: 0.2rem;
    }

    .loading-sub {
      color: var(--text-muted);
      font-size: 0.78rem;
    }

    .loading-steps {
      margin-top: 0.6rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      font-size: 0.75rem;
    }

    .loading-pill {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      color: var(--text-muted);
    }

    /* ====== Results ====== */
    #results-section {
      display: none;
    }

    .results-grid {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (min-width: 768px) {
      .results-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .results-summary-card {
      background: var(--bg-card);
      border-radius: 1.25rem;
      padding: 1.3rem;
      border: 1px solid var(--border);
    }

    /* score bands */
    .results-summary-card.band-low {
      border-color: rgba(249, 115, 115, 0.8);
    }

    .results-summary-card.band-mid {
      border-color: rgba(234, 179, 8, 0.8);
    }

    .results-summary-card.band-high {
      border-color: rgba(74, 222, 128, 0.8);
    }

    .results-summary-card.band-low .score-badge {
      color: var(--danger);
    }

    .results-summary-card.band-mid .score-badge {
      color: #eab308;
    }

    .results-summary-card.band-high .score-badge {
      color: var(--success);
    }

    .score-badge {
      display: inline-flex;
      align-items: baseline;
      gap: 0.2rem;
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
    }

    .score-badge span {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.6rem;
      font-size: 0.75rem;
    }

    .pill {
      padding: 0.25rem 0.55rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted);
    }

    .pill.primary {
      border-color: rgba(58, 191, 248, 0.8);
      color: var(--accent);
    }

    .subscore-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 0.9rem;
      border: 1px solid var(--border);
      font-size: 0.85rem;
    }

    .subscore-title {
      font-weight: 500;
      margin-bottom: 0.2rem;
    }

    .subscore-value {
      font-size: 1.2rem;
      margin-bottom: 0.2rem;
    }

    .subscore-label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .root-causes {
      margin-top: 1rem;
      background: var(--bg-card);
      border-radius: 1.25rem;
      padding: 1.2rem;
      border: 1px solid var(--border);
      font-size: 0.85rem;
    }

    .root-item {
      margin-top: 0.6rem;
    }

    .root-title {
      font-weight: 500;
      margin-bottom: 0.15rem;
    }

    .plan-list {
      margin-top: 0.9rem;
      display: grid;
      gap: 0.7rem;
    }

    .day-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 0.9rem;
      border: 1px solid var(--border);
      font-size: 0.83rem;
    }

    .day-header {
      font-weight: 500;
      margin-bottom: 0.2rem;
    }

    .day-focus {
      font-size: 0.8rem;
      color: var(--accent);
      margin-bottom: 0.25rem;
    }

    .day-actions {
      margin-left: 1rem;
      list-style: disc;
      margin-top: 0.2rem;
    }

    .routine-card {
      background: var(--bg-card);
      border-radius: 1.25rem;
      padding: 1.1rem;
      border: 1px solid var(--border);
      font-size: 0.85rem;
      margin-top: 1rem;
    }

    .routine-block {
      margin-top: 0.6rem;
    }

    .routine-time {
      font-weight: 500;
      margin-bottom: 0.15rem;
    }

    .results-actions {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      font-size: 0.8rem;
    }

    .btn-secondary {
      padding: 0.6rem 1.05rem;
      border-radius: 999px;
      background: transparent;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-main);
    }

    footer {
      padding: 2rem 0 3rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <div class="logo">
        Sleep<span>scan</span> AI
      </div>
      <nav class="nav-links">
        <a href="#how-it-works">How it works</a>
        <a href="#form-section">Sleep scan</a>
        <button class="nav-cta" onclick="scrollToForm()">
          Start diagnosis
        </button>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-inner">
      <div>
        <div class="hero-eyebrow">AI sleep coach</div>
        <h1 class="hero-title">Understand your sleep. Fix your routine.</h1>
        <p class="hero-subtext">
          Sleepscan AI reads your habits, finds the real reason you are tired,
          and builds a simple 7 day plan to improve your nights.
        </p>
        <div class="hero-chips">
          <div class="chip">Sleep smarter with AI</div>
          <div class="chip">No wearable needed</div>
          <div class="chip">Takes under 2 minutes</div>
        </div>
        <div class="hero-actions">
          <button class="btn-primary" onclick="scrollToForm()">
            Start your sleep scan
          </button>
          <button class="btn-ghost">No login. No email. Just answers.</button>
        </div>
      </div>
      <div>
        <div class="hero-card">
          <div class="hero-card-label">Sample sleep report</div>
          <div class="hero-card-score">
            63<span>/100</span>
          </div>
          <div class="hero-card-text">
            Your sleep is moderate, but late screens and inconsistent bedtimes
            are blocking deeper rest.
          </div>
          <div class="hero-card-pill">
            <span class="hero-card-pill-dot"></span>
            Biggest blocker: screen time before bed
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- How it works -->
  <section id="how-it-works">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">How Sleepscan AI works</h2>
        <p class="section-subtitle">
          A simple 3 step scan that turns your daily habits into a clear plan.
        </p>
      </div>
      <div class="how-grid">
        <div class="how-card">
          <div class="how-step">Step 1</div>
          <div class="how-title">Tell us how you sleep</div>
          <div class="how-body">
            Enter a few details about your sleep schedule, stress and habits
            before bed.
          </div>
        </div>
        <div class="how-card">
          <div class="how-step">Step 2</div>
          <div class="how-title">Get your sleep scan</div>
          <div class="how-body">
            Sleepscan AI calculates your sleep score and finds the key root
            causes affecting your rest.
          </div>
        </div>
        <div class="how-card">
          <div class="how-step">Step 3</div>
          <div class="how-title">Fix it in 7 days</div>
          <div class="how-body">
            Follow a simple 7 day plan tailored to your lifestyle and energy
            levels.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Form -->
  <section id="form-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Start your sleep scan</h2>
        <p class="section-subtitle">
          Answer a few quick questions so Sleepscan AI can analyze your sleep.
        </p>
      </div>
      <div class="card">
        <form id="sleep-form">
          <div class="form-grid">
            <!-- Sleep basics -->
            <div class="field">
              <label for="hours">Average hours of sleep per night</label>
              <span>Usually in a typical weekday.</span>
              <input
                id="hours"
                name="hours"
                type="number"
                min="3"
                max="12"
                step="0.5"
                class="input"
                required
              />
            </div>

            <div class="field">
              <label for="bedtime">Usual bedtime</label>
              <span>Approximate time you go to bed.</span>
              <input id="bedtime" name="bedtime" type="time" class="input" required />
            </div>

            <div class="field">
              <label for="waketime">Usual wake up time</label>
              <span>Approximate time you wake up.</span>
              <input id="waketime" name="waketime" type="time" class="input" required />
            </div>

            <div class="field">
              <label for="consistency">How often do your sleep times change?</label>
              <span>Changes in bed and wake times per week.</span>
              <select id="consistency" name="consistency" class="select" required>
                <option value="">Select one</option>
                <option value="never">Almost never</option>
                <option value="1-2">1 to 2 days per week</option>
                <option value="3-4">3 to 4 days per week</option>
                <option value="always">Almost every day</option>
              </select>
            </div>

            <!-- Evening habits -->
            <div class="field">
              <label for="screen">Screen time within 1 hour before bed</label>
              <select id="screen" name="screen" class="select" required>
                <option value="">Select one</option>
                <option value="none">None</option>
                <option value="<30">Under 30 minutes</option>
                <option value="30-60">30 to 60 minutes</option>
                <option value=">60">More than 60 minutes</option>
              </select>
            </div>

            <div class="field">
              <label for="caffeine">Caffeine intake per day</label>
              <select id="caffeine" name="caffeine" class="select" required>
                <option value="">Select one</option>
                <option value="0">None</option>
                <option value="1">1 cup</option>
                <option value="2">2 cups</option>
                <option value="3+">3 or more cups</option>
              </select>
            </div>

            <div class="field">
              <label for="meal">Last heavy meal before bed</label>
              <select id="meal" name="meal" class="select" required>
                <option value="">Select one</option>
                <option value="2+">2+ hours before</option>
                <option value="1-2">1 to 2 hours before</option>
                <option value="<1">Under 1 hour before</option>
              </select>
            </div>

            <!-- Lifestyle and stress -->
            <div class="field">
              <label for="stress">Daily stress level</label>
              <span>1 is calm, 5 is very high.</span>
              <input
                id="stress"
                name="stress"
                type="range"
                min="1"
                max="5"
                value="3"
                class="range"
              />
            </div>

            <div class="field">
              <label for="activity">Physical activity per week</label>
              <select id="activity" name="activity" class="select" required>
                <option value="">Select one</option>
                <option value="none">None</option>
                <option value="1-2">1 to 2 days</option>
                <option value="3-4">3 to 4 days</option>
                <option value="5+">5+ days</option>
              </select>
            </div>

            <div class="field">
              <label for="wakeups">Night awakenings</label>
              <span>How often you wake up during the night.</span>
              <select id="wakeups" name="wakeups" class="select" required>
                <option value="">Select one</option>
                <option value="rarely">Rarely</option>
                <option value="1-2">1 to 2 times</option>
                <option value="3+">3+ times</option>
              </select>
            </div>

            <div class="field" style="grid-column: 1 / -1;">
              <label for="notes">Anything else about your sleep?</label>
              <span>Optional. For example: snoring, shift work, new parent etc.</span>
              <textarea id="notes" name="notes" class="textarea"></textarea>
            </div>
          </div>

          <div class="form-footer">
            <button type="submit" class="btn-primary btn-submit">
              Generate my sleep report
            </button>
            <span>
              Sleepscan AI does not replace medical advice. For serious sleep concerns,
              please speak with a doctor.
            </span>
          </div>
        </form>

        <div id="loading" class="loading">
          <div class="loading-title">Analyzing your sleep pattern...</div>
          <div class="loading-sub">
            Looking at duration, consistency, habits and stress.
          </div>
          <div class="loading-steps">
            <div class="loading-pill">Scanning sleep duration</div>
            <div class="loading-pill">Checking routine consistency</div>
            <div class="loading-pill">Reviewing evening habits</div>
            <div class="loading-pill">Building your 7 day plan</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Results -->
  <section id="results-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Your Sleepscan summary</h2>
        <p class="section-subtitle">
          A quick overview of your sleep score, key blockers and what to focus on next.
        </p>
      </div>

      <!-- Summary and breakdown -->
      <div class="results-grid">
        <div class="results-summary-card" id="results-summary-card">
          <div id="overall-score" class="score-badge">
            0<span>/100</span>
          </div>
          <div id="score-label" style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.3rem;">
          </div>
          <div id="overall-text" style="font-size: 0.9rem; margin-bottom: 0.4rem;">
            Your sleep summary will appear here after the scan.
          </div>
          <div id="focus-text" style="font-size: 0.8rem; color: var(--text-muted);">
          </div>
          <div id="pill-row" class="pill-row" style="margin-top: 0.7rem;">
            <!-- filled by JS -->
          </div>
        </div>

        <div class="results-grid" id="subscores-grid">
          <!-- Subscore cards injected here -->
        </div>
      </div>

      <!-- Root causes -->
      <div class="root-causes">
        <div style="font-weight: 600; margin-bottom: 0.3rem;">
          What is really affecting your sleep
        </div>
        <div id="root-summary">
          Sleepscan AI will explain your main sleep blockers here.
        </div>
        <div id="root-list">
          <!-- Root cause items injected here -->
        </div>
      </div>

      <!-- 7 day plan -->
      <div style="margin-top: 1.4rem;" id="plan-section">
        <div class="section-header" style="margin-bottom: 0.6rem;">
          <h3 class="section-title" style="font-size: 1.1rem;">
            Your 7 day sleep reset plan
          </h3>
          <p class="section-subtitle">
            One small focus each day, designed around your current routine.
          </p>
        </div>
        <div id="plan-list" class="plan-list">
          <!-- Day cards injected here -->
        </div>
      </div>

      <!-- Night routine -->
      <div class="routine-card" id="routine-card">
        <div style="font-weight: 600;">Your 30 minute wind down routine</div>
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.15rem;">
          Use this on any night you want a reset into calmer sleep.
        </div>
        <div id="routine-blocks">
          <!-- Routine blocks injected here -->
        </div>
      </div>

      <div class="results-actions">
        <button class="btn-secondary" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
          Start a new scan
        </button>
        <button class="btn-secondary" onclick="copyPlanToClipboard()">
          Copy summary
        </button>
        <button class="btn-secondary" onclick="downloadPdf()">
          Download plan as PDF
        </button>
      </div>
    </div>
  </section>

  <footer>
    Built by Varun Srikanth. Sleepscan AI is a personal project and does not provide
    medical advice.
  </footer>

  <!-- jsPDF for PDF export -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    function scrollToForm() {
      const el = document.getElementById("form-section");
      el.scrollIntoView({ behavior: "smooth" });
    }

    const form = document.getElementById("sleep-form");
    const loadingEl = document.getElementById("loading");
    const resultsSection = document.getElementById("results-section");
    let lastResult = null;

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      // Show loading
      loadingEl.style.display = "block";
      resultsSection.style.display = "none";

      // Gather inputs
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      data.stress = document.getElementById("stress").value;

      // Simulate AI delay, then use a fake AI response for now
      setTimeout(() => {
        const aiResult = fakeAiResponse(data);
        renderResults(aiResult);
        loadingEl.style.display = "none";
        resultsSection.style.display = "block";
        resultsSection.scrollIntoView({ behavior: "smooth" });
      }, 1200);
    });

    function getScoreBand(score) {
      if (score < 45) {
        return { label: "Needs more support", bandClass: "band-low" };
      }
      if (score < 75) {
        return { label: "Moderate, room to improve", bandClass: "band-mid" };
      }
      return { label: "Strong foundation", bandClass: "band-high" };
    }

    // This function simulates AI logic for now
    function fakeAiResponse(inputs) {
      const hours = parseFloat(inputs.hours || "0");
      const stressValue = parseInt(inputs.stress, 10) || 3;

      // Flags from inputs
      const shortSleep = hours > 0 && hours < 6;
      const veryShortSleep = hours > 0 && hours < 5.5;
      const longSleep = hours > 9;

      const irregular =
        inputs.consistency === "3-4" || inputs.consistency === "always";

      const lateScreens =
        inputs.screen === ">60" || inputs.screen === "30-60";
      const heavyScreens = inputs.screen === ">60";

      const heavyCaffeine = inputs.caffeine === "3+";
      const someCaffeine = inputs.caffeine === "2" || inputs.caffeine === "1";

      const lateMeal = inputs.meal === "<1";
      const mediumLateMeal = inputs.meal === "1-2";

      const lowActivity =
        inputs.activity === "none" || inputs.activity === "1-2";

      const frequentWake = inputs.wakeups === "3+";
      const someWake = inputs.wakeups === "1-2";

      const highStress = stressValue >= 4;

      const notesText = (inputs.notes || "").toLowerCase();
      const mentionsSnoring = notesText.includes("snor");
      const mentionsShift =
        notesText.includes("shift") || notesText.includes("night shift");
      const mentionsParent =
        notesText.includes("baby") ||
        notesText.includes("new parent") ||
        notesText.includes("toddler");

      // Overall score
      let score = 80;

      if (veryShortSleep) {
        score -= 25;
      } else if (shortSleep) {
        score -= 15;
      }

      if (longSleep) {
        score -= 5;
      }

      if (irregular) {
        score -= 10;
      }

      if (heavyScreens) {
        score -= 12;
      } else if (lateScreens) {
        score -= 7;
      }

      if (heavyCaffeine) {
        score -= 8;
      } else if (someCaffeine) {
        score -= 3;
      }

      if (lateMeal) {
        score -= 7;
      } else if (mediumLateMeal) {
        score -= 4;
      }

      if (lowActivity) {
        score -= 6;
      }

      if (frequentWake) {
        score -= 10;
      } else if (someWake) {
        score -= 5;
      }

      if (highStress) {
        score -= 10;
      }

      if (mentionsShift || mentionsParent) {
        score -= 5;
      }

      if (score < 5) score = 5;
      if (score > 95) score = 95;

      // Subscores
      const durationValue = (() => {
        if (veryShortSleep) return 45;
        if (shortSleep) return 55;
        if (hours >= 6 && hours <= 8.5) return 85;
        if (longSleep) return 65;
        return 60;
      })();

      const durationLabel =
        hours === 0
          ? "Once you track your typical sleep hours, this score will adjust."
          : shortSleep
          ? "You are regularly sleeping less than your body likely needs. Extending your sleep window even by 30 to 45 minutes can help."
          : longSleep
          ? "You may be sleeping longer than average. That can be a sign of recovery needs or fragmented sleep during the night."
          : "Your sleep duration is mostly in a healthy range. The focus is more on timing and sleep quality.";

      const routineValue = irregular ? 55 : inputs.consistency === "1-2" ? 75 : 90;

      const routineLabel = irregular
        ? "Changes in your sleep and wake times are making it harder to reach deeper sleep. A more predictable window will help your body clock."
        : inputs.consistency === "1-2"
        ? "Your body clock is getting some stability. Small improvements in consistency will give you more reliable energy."
        : "Your body clock benefits from a stable routine. This is a strength to keep.";

      const stressSubValue = Math.max(
        30,
        Math.min(90, 100 - stressValue * 12)
      );

      const stressLabel = highStress
        ? "High stress is likely carrying into the night and making it harder to switch off in bed."
        : stressValue === 1
        ? "Your stress looks relatively low. This helps your body wind down and stay asleep."
        : "Your stress is present but somewhat manageable. A short wind down routine can prevent it from spilling into bedtime.";

      const eveningValue = (() => {
        let val = 85;
        if (heavyScreens) val -= 30;
        else if (lateScreens) val -= 18;

        if (heavyCaffeine) val -= 12;
        else if (someCaffeine) val -= 5;

        if (lateMeal) val -= 10;
        else if (mediumLateMeal) val -= 5;

        return Math.max(35, Math.min(90, val));
      })();

      const eveningLabel =
        heavyScreens || lateScreens || lateMeal || heavyCaffeine
          ? "Evening stimulation from screens, caffeine or late meals is making it harder for your brain and body to power down."
          : "Your evening habits are relatively sleep friendly. Small refinements around light and calm activities can still improve sleep depth.";

      const subs = [
        {
          name: "Sleep duration",
          value: durationValue,
          label: durationLabel,
        },
        {
          name: "Routine consistency",
          value: routineValue,
          label: routineLabel,
        },
        {
          name: "Stress impact",
          value: stressSubValue,
          label: stressLabel,
        },
        {
          name: "Evening habits",
          value: eveningValue,
          label: eveningLabel,
        },
      ];

      // Root causes
      const rootCauses = [];

      if (shortSleep || veryShortSleep) {
        rootCauses.push({
          title: "Short sleep window",
          text:
            "Your current sleep window is likely not giving your body enough time to cycle through deep and REM sleep. Even 30 to 45 extra minutes can change how rested you feel.",
        });
      }

      if (irregular) {
        rootCauses.push({
          title: "Irregular sleep timing",
          text:
            "Frequent changes in when you go to bed or wake up make it harder for your body to predict when to lower alertness and enter deeper sleep stages.",
        });
      }

      if (heavyScreens || lateScreens) {
        rootCauses.push({
          title: "High screen exposure before bed",
          text:
            "Long or late screen use keeps your brain active and reduces melatonin release, which can delay sleep and reduce sleep depth.",
        });
      }

      if (heavyCaffeine || someCaffeine || lateMeal || mediumLateMeal) {
        rootCauses.push({
          title: "Late stimulation from caffeine or food",
          text:
            "Caffeine later in the day and heavy meals close to bedtime can keep your body in a more activated state, making it harder to fall asleep or stay asleep.",
        });
      }

      if (frequentWake || someWake) {
        rootCauses.push({
          title: "Fragmented sleep",
          text:
            "Waking up during the night breaks up sleep cycles. This can leave you feeling unrefreshed even when the total hours look acceptable.",
        });
      }

      if (lowActivity) {
        rootCauses.push({
          title: "Low daytime movement",
          text:
            "Limited physical activity during the day can reduce sleep pressure at night and make it harder to fall asleep or feel deeply rested.",
        });
      }

      if (highStress) {
        rootCauses.push({
          title: "Mental load and stress",
          text:
            "Higher stress levels keep your mind in problem solving mode, which means you are more likely to stay alert in bed or wake during the night.",
        });
      }

      if (mentionsShift) {
        rootCauses.push({
          title: "Shift based schedule",
          text:
            "Shift work or irregular work hours can disrupt your natural body clock. You may need a stronger focus on anchor times and light exposure.",
        });
      }

      if (mentionsParent) {
        rootCauses.push({
          title: "Life events and caregiving",
          text:
            "Caring for a baby or young child often brings unavoidable night awakenings. The focus is on protecting a realistic sleep window and recovery moments.",
        });
      }

      if (mentionsSnoring) {
        rootCauses.push({
          title: "Possible breathing interruptions",
          text:
            "Snoring and breathing interruptions can affect sleep quality. If this is frequent or loud, it is worth discussing with a health professional.",
        });
      }

      if (rootCauses.length === 0) {
        rootCauses.push({
          title: "Subtle habit friction",
          text:
            "None of your answers point to a single big blocker. Small improvements across timing, wind down and movement can still improve how rested you feel.",
        });
      }

      const trimmedRootCauses = rootCauses.slice(0, 4);

      // Root summary
      const summaryParts = [];

      if (shortSleep || veryShortSleep) {
        summaryParts.push("your sleep window is on the shorter side");
      }

      if (irregular) {
        summaryParts.push("your sleep and wake times vary on many days");
      }

      if (heavyScreens || lateScreens) {
        summaryParts.push("screens are active quite close to bedtime");
      }

      if (highStress) {
        summaryParts.push("stress or mental load stays high into the evening");
      }

      if (frequentWake || someWake) {
        summaryParts.push("your sleep is often broken by awakenings");
      }

      if (summaryParts.length === 0) {
        summaryParts.push(
          "your sleep is affected by a mix of smaller habits rather than one single factor"
        );
      }

      const rootSummary =
        "Based on your answers, " +
        summaryParts.join(", ").replace(", your", " and your") +
        ". The plan below focuses on things you can realistically adjust in the next week.";

      // Plan
      const plan = [];

      plan.push({
        day: "Day 1",
        focus: "Set a realistic sleep window",
        actions: [
          "Pick a target bedtime and wake time within a 30 minute window that fits your current life.",
          "Try not to shift this window today, even if you fall asleep a little later than planned.",
        ],
      });

      if (heavyScreens || lateScreens) {
        plan.push({
          day: "Day 2",
          focus: "Reduce late screen exposure",
          actions: [
            "Aim to put your main screens away at least 30 minutes before bed tonight.",
            "Use that time for a calm activity such as reading, stretching or light journaling.",
          ],
        });
      } else {
        plan.push({
          day: "Day 2",
          focus: "Create a calm pre sleep environment",
          actions: [
            "Dim bright lights 30 minutes before bed and reduce notifications.",
            "Choose one low stimulation activity to repeat most nights before sleep.",
          ],
        });
      }

      if (heavyCaffeine || someCaffeine || lateMeal || mediumLateMeal) {
        plan.push({
          day: "Day 3",
          focus: "Adjust caffeine and meal timing",
          actions: [
            "Keep your last caffeinated drink at least 6 hours before your planned bedtime.",
            "Try to finish heavy meals at least 2 hours before bed and notice if falling asleep feels easier.",
          ],
        });
      } else {
        plan.push({
          day: "Day 3",
          focus: "Fine tune your bedroom setup",
          actions: [
            "Check your bedroom for light, noise and temperature that might wake you up.",
            "Make one small change, such as darker curtains or a slightly cooler room.",
          ],
        });
      }

      if (lowActivity) {
        plan.push({
          day: "Day 4",
          focus: "Add gentle daytime movement",
          actions: [
            "Include at least 10 to 20 minutes of light movement, like a walk or easy stretching.",
            "Try to keep this movement earlier in the day rather than close to bedtime.",
          ],
        });
      } else {
        plan.push({
          day: "Day 4",
          focus: "Use movement to support sleep",
          actions: [
            "Notice how your current activity level affects your energy at night.",
            "If you already move often, add a short walk or stretch on days you feel more wired.",
          ],
        });
      }

      plan.push({
        day: "Day 5",
        focus: "Build a simple wind down routine",
        actions: [
          "Decide on a 20 to 30 minute routine that you can repeat on most nights, even on busy days.",
          "Keep it simple and predictable so your body learns that this routine means sleep is coming.",
        ],
      });

      if (frequentWake || someWake || mentionsParent || mentionsShift) {
        plan.push({
          day: "Day 6",
          focus: "Support fewer night awakenings",
          actions: [
            "Avoid extra fluids right before bed unless needed for medical reasons.",
            "If you wake up, keep lights low and avoid checking your phone so you can return to sleep faster.",
          ],
        });
      } else {
        plan.push({
          day: "Day 6",
          focus: "Protect your sleep window",
          actions: [
            "Try to keep your sleep and wake times within the same 30 minute window.",
            "Avoid the temptation to sleep in much later than usual, even after a rough night.",
          ],
        });
      }

      plan.push({
        day: "Day 7",
        focus: "Review and adjust",
        actions: [
          "Notice how your energy, focus and mood have changed across the week.",
          "Decide which two habits made the biggest positive difference and commit to them for the next two weeks.",
        ],
      });

      // Night routine
      const routine = [
        {
          time: "30 minutes before bed",
          text:
            "Dim bright lights, reduce notifications and finish any stimulating tasks for the day. This tells your brain that the day is closing.",
        },
        {
          time: "20 minutes before bed",
          text:
            "Do one calm, screen free activity such as reading a few pages, light stretching or jotting down tomorrow's tasks so your mind is not holding them.",
        },
        {
          time: "10 minutes before bed",
          text:
            "Practice a simple breathing pattern like 4 seconds in, 4 seconds hold and 6 seconds out for 5 to 10 rounds to gently slow your system.",
        },
      ];

      let overallText =
        "Your sleep is in a moderate place, but your routine and evening habits are limiting how restored you feel in the morning.";

      if (score < 45) {
        overallText =
          "Your sleep needs more support. The mix of short or fragmented sleep, irregular timing and stimulating evenings is making it hard for you to recover fully.";
      } else if (score > 75) {
        overallText =
          "Your sleep foundation is fairly solid. A few targeted changes around consistency, stress and evening habits can unlock deeper rest.";
      }

      let focusText = "";

      if (irregular && (heavyScreens || lateScreens)) {
        focusText =
          "Primary focus for the next 7 days: make your sleep and wake times more predictable and gently reduce late screen exposure.";
      } else if (irregular) {
        focusText =
          "Primary focus for the next 7 days: protect a consistent sleep window so your body knows when to power down.";
      } else if (heavyScreens || lateScreens) {
        focusText =
          "Primary focus for the next 7 days: reduce evening stimulation from screens so your brain can switch into sleep mode more easily.";
      } else if (shortSleep || veryShortSleep) {
        focusText =
          "Primary focus for the next 7 days: extend your realistic sleep window and protect it as much as your life allows.";
      } else if (highStress) {
        focusText =
          "Primary focus for the next 7 days: use a short, repeatable wind down routine to separate daytime stress from sleep.";
      } else {
        focusText =
          "Primary focus for the next 7 days: keep your sleep window predictable and repeat a simple wind down routine most nights.";
      }

      const pillLabels = [];

      if (shortSleep || veryShortSleep) {
        pillLabels.push("short sleep window");
      }
      if (irregular) {
        pillLabels.push("shifting sleep times");
      }
      if (heavyScreens || lateScreens) {
        pillLabels.push("late screen exposure");
      }
      if (highStress) {
        pillLabels.push("evening stress and mental load");
      }
      if (heavyCaffeine || someCaffeine || lateMeal || mediumLateMeal) {
        pillLabels.push("caffeine and late meals");
      }
      if (frequentWake || someWake) {
        pillLabels.push("night awakenings");
      }
      if (lowActivity) {
        pillLabels.push("low daytime movement");
      }

      const pills = [];

      if (pillLabels.length > 0) {
        pills.push("Biggest blocker: " + pillLabels[0]);
      } else {
        pills.push("Biggest blocker: subtle habit friction");
      }

      if (pillLabels.length > 1) {
        pills.push("Secondary: " + pillLabels[1]);
      }

      if (pillLabels.length > 2) {
        pills.push("Support focus: " + pillLabels[2]);
      } else {
        pills.push("Support focus: wind down and movement");
      }

      return {
        score,
        subs,
        rootSummary,
        rootCauses: trimmedRootCauses,
        plan,
        routine,
        overallText,
        focusText,
        pills,
      };
    }

    function renderResults(result) {
      lastResult = result;

      // Overall score and text
      const scoreEl = document.getElementById("overall-score");
      scoreEl.innerHTML = `${Math.round(result.score)}<span>/100</span>`;

      document.getElementById("overall-text").textContent =
        result.overallText || "";
      document.getElementById("focus-text").textContent =
        result.focusText || "";

      const bandInfo = getScoreBand(result.score);
      const labelEl = document.getElementById("score-label");
      if (labelEl && bandInfo) {
        labelEl.textContent = bandInfo.label;
      }
      const summaryCard = document.getElementById("results-summary-card");
      if (summaryCard && bandInfo) {
        summaryCard.classList.remove("band-low", "band-mid", "band-high");
        summaryCard.classList.add(bandInfo.bandClass);
      }

      // Pills
      const pillRow = document.getElementById("pill-row");
      pillRow.innerHTML = "";
      result.pills.forEach((p, idx) => {
        const div = document.createElement("div");
        div.className = "pill" + (idx === 0 ? " primary" : "");
        div.textContent = p;
        pillRow.appendChild(div);
      });

      // Subscores
      const subsGrid = document.getElementById("subscores-grid");
      subsGrid.innerHTML = "";
      result.subs.forEach((sub) => {
        const card = document.createElement("div");
        card.className = "subscore-card";
        card.innerHTML = `
          <div class="subscore-title">${sub.name}</div>
          <div class="subscore-value">${Math.round(sub.value)}/100</div>
          <div class="subscore-label">${sub.label}</div>
        `;
        subsGrid.appendChild(card);
      });

      // Root causes
      document.getElementById("root-summary").textContent =
        result.rootSummary || "";

      const rootList = document.getElementById("root-list");
      rootList.innerHTML = "";
      result.rootCauses.forEach((rc) => {
        const div = document.createElement("div");
        div.className = "root-item";
        div.innerHTML = `
          <div class="root-title">${rc.title}</div>
          <div>${rc.text}</div>
        `;
        rootList.appendChild(div);
      });

      // 7 day plan
      const planList = document.getElementById("plan-list");
      planList.innerHTML = "";
      result.plan.forEach((day) => {
        const card = document.createElement("div");
        card.className = "day-card";
        const actionsHtml = day.actions.map((a) => `<li>${a}</li>`).join("");
        card.innerHTML = `
          <div class="day-header">${day.day}</div>
          <div class="day-focus">${day.focus}</div>
          <ul class="day-actions">${actionsHtml}</ul>
        `;
        planList.appendChild(card);
      });

      // Night routine
      const routineBlocks = document.getElementById("routine-blocks");
      routineBlocks.innerHTML = "";
      result.routine.forEach((r) => {
        const block = document.createElement("div");
        block.className = "routine-block";
        block.innerHTML = `
          <div class="routine-time">${r.time}</div>
          <div>${r.text}</div>
        `;
        routineBlocks.appendChild(block);
      });
    }

    async function copyPlanToClipboard() {
      if (!lastResult) {
        alert("Please run a sleep scan first.");
        return;
      }

      let text = "";
      text += "Sleepscan AI - Your sleep summary\n\n";
      text += `Score: ${Math.round(lastResult.score)}/100\n`;
      text += `${lastResult.overallText}\n\n`;
      text += `Focus: ${lastResult.focusText}\n\n`;

      text += "Key blockers:\n";
      lastResult.pills.forEach((p) => {
        text += `- ${p}\n`;
      });

      text += "\nRoot causes:\n";
      lastResult.rootCauses.forEach((rc) => {
        text += `â€¢ ${rc.title}: ${rc.text}\n`;
      });

      text += "\n7 day plan:\n";
      lastResult.plan.forEach((day) => {
        text += `${day.day} - ${day.focus}\n`;
        day.actions.forEach((a) => {
          text += `  - ${a}\n`;
        });
        text += "\n";
      });

      text += "Wind down routine:\n";
      lastResult.routine.forEach((r) => {
        text += `${r.time}: ${r.text}\n`;
      });

      try {
        await navigator.clipboard.writeText(text);
        alert("Summary copied to clipboard.");
      } catch (err) {
        alert("Could not copy to clipboard. Please try again.");
      }
    }

    function downloadPdf() {
      if (!lastResult) {
        alert("Please run a sleep scan first.");
        return;
      }

      if (!window.jspdf || !window.jspdf.jsPDF) {
        alert("PDF library failed to load. Please refresh the page and try again.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      let y = 10;
      const lineHeight = 6;
      const pageHeight = doc.internal.pageSize.getHeight();
      const margin = 10;

      function addWrappedText(text, x, yPos, maxWidth) {
        const lines = doc.splitTextToSize(text, maxWidth);
        lines.forEach((line) => {
          if (yPos + lineHeight > pageHeight - margin) {
            doc.addPage();
            yPos = margin;
          }
          doc.text(line, x, yPos);
          yPos += lineHeight;
        });
        return yPos;
      }

      doc.setFontSize(16);
      doc.text("Sleepscan AI - Sleep report", margin, y);
      y += lineHeight * 1.5;

      doc.setFontSize(12);
      y = addWrappedText(
        `Score: ${Math.round(lastResult.score)}/100`,
        margin,
        y,
        180
      );

      y = addWrappedText(lastResult.overallText, margin, y + 2, 180);
      y = addWrappedText("Focus:", margin, y + 4, 180);
      y = addWrappedText(lastResult.focusText, margin + 4, y, 176);

      y += 4;
      doc.setFontSize(12);
      y = addWrappedText("Key blockers:", margin, y, 180);
      lastResult.pills.forEach((p) => {
        y = addWrappedText(`- ${p}`, margin + 4, y, 176);
      });

      y += 4;
      y = addWrappedText("Root causes:", margin, y, 180);
      lastResult.rootCauses.forEach((rc) => {
        y = addWrappedText(`â€¢ ${rc.title}`, margin + 2, y, 176);
        y = addWrappedText(rc.text, margin + 6, y, 172);
      });

      y += 4;
      y = addWrappedText("7 day plan:", margin, y, 180);
      lastResult.plan.forEach((day) => {
        y = addWrappedText(`${day.day} - ${day.focus}`, margin + 2, y, 176);
        day.actions.forEach((a) => {
          y = addWrappedText(`- ${a}`, margin + 6, y, 172);
        });
        y += 2;
      });

      y += 2;
      y = addWrappedText("Wind down routine:", margin, y, 180);
      lastResult.routine.forEach((r) => {
        y = addWrappedText(`${r.time}: ${r.text}`, margin + 2, y, 176);
      });

      doc.save("sleepscan-report.pdf");
    }

    // Later you can replace fakeAiResponse with a real API call structure like:
    // async function fetchAiResponse(inputs) {
    //   const prompt = buildPrompt(inputs);
    //   const response = await fetch("YOUR_BACKEND_ENDPOINT", { ... });
    //   return await response.json();
    // }
  </script>
</body>
</html>
